# AgentPress 增强版系统设计文档

## 项目概述

AgentPress增强版是一个现代化的多智能体AI写作平台，支持图形化界面、知识库增强、多模型选择以及灵活的提示词管理系统，专门用于生成1-2万字的高质量短篇小说。

## 架构设计

### 目录结构
```
AgentPress/
├── apps/                   # 应用程序入口
│   ├── web_ui.py           # Web图形界面主应用
│   ├── cli.py              # 命令行界面
│   └── routes/             # API路由模块
│       ├── agent_routes.py # 代理配置路由
│       ├── model_routes.py # 模型选择路由
│       ├── prompt_routes.py # 提示词管理路由
│       ├── knowledge_routes.py # 知识库路由
│       └── generation_routes.py # 创作流程路由
├── core/                   # 核心业务逻辑
│   ├── workflow.py         # 工作流编排（1-2万字创作流程）
│   ├── agent_manager.py    # 多模型智能体管理
│   └── conversation_manager.py # 对话历史管理
├── ai_agents/              # AI代理实现
│   ├── base.py             # 代理基类
│   ├── multi_model_agents.py # 多模型智能体实现
│   ├── writer.py           # 作家角色（可选择生成模型）
│   ├── editor.py           # 编辑角色（可选择评价模型）
│   ├── fact_checker.py     # 事实检查员（可选择推理模型）
│   ├── dialogue_specialist.py # 对话专家（可选择对话模型）
│   └── documentation_specialist.py # 档案员
├── knowledge/              # 知识库系统
│   ├── documents/          # 原始知识文档存储
│   ├── templates/          # 预构建的知识模板库
│   ├── manager.py          # 知识库管理器
│   ├── storage.py          # 存储抽象层
│   ├── indexer.py          # 向量索引构建
│   ├── retriever.py        # 检索服务
│   └── vector_store/       # 向量存储目录
├── prompts/                # 提示词管理
│   ├── templates/          # 提示词模板目录
│   ├── manager.py          # 提示词管理器
│   └── base_templates.py   # 基础模板库
├── ui/                     # 前端界面
│   ├── templates/          # HTML模板
│   ├── static/             # 静态资源
│   │   ├── css/            # 样式文件
│   │   ├── js/             # JavaScript
│   │   └── images/         # 图片资源
│   └── components/         # UI组件
├── configs/                # 配置文件
│   ├── app_config.json     # 应用配置
│   ├── default_prompts.yaml # 默认提示词配置
│   └── model_configs/      # 模型配置
├── data/                   # 数据文件
│   ├── knowledge_repo/     # 知识库内容
│   ├── samples/            # 示例数据
│   └── exports/            # 导出数据
├── tests/                  # 测试文件
│   └── integration/        # 集成测试
├── scripts/                # 脚本文件
│   ├── migrate_kb.py       # 知识库迁移脚本
│   └── init_data.py        # 初始化数据脚本
└── requirements.txt        # 依赖列表
```

## 核心功能模块

### 1. 图形用户界面 (Web UI)

#### 技术栈
- Web框架：FastAPI/Flask
- 前端：React/Vue.js 或 HTML + JavaScript
- 状态管理：现代化状态管理方案

#### 主要界面
- **控制台面板**：创作进度监控、系统状态显示
- **提示词编辑器**：富文本界面，支持实时编辑和测试
- **知识库管理**：分类、标签、搜索、导入/导出
- **模型配置器**：为各角色分配不同模型
- **创作工作流**：可视化创作流程、参数调整

### 2. 多模型智能体架构

#### 设计原则
- 单一职责：各代理角色职责明确
- 模型适配：每类代理可选择不同AI模型
- 状态管理：持久化每个创作任务的状态

#### 代理角色功能细化
- **作家**：核心创作，生成高质量故事
  - 推荐模型：GPT-4、Qwen-Max等
  - 支持分段生成（章节划分）

- **神话学家**：背景研究与设定（主题不限于山海经）
  - 推荐模型：通用推理能力较强模型
  - 支持知识检索和整合

- **事实检查员**：逻辑一致性检查
  - 推荐模型：逻辑推理能力强的模型
  - 检查情节冲突、人物设定一致性

- **对话专家**：对话优化
  - 推荐模型：对话理解能力佳的模型
  - 检查对话自然性和人物特色

- **编辑**：质量把控
  - 推荐模型：综合判断力强的模型
  - 评估整体质量和读者吸引力

- **档案员**：文档维护
  - 推荐模型：长程上下文处理能力强的模型
  - 维护人物、设定、情节线索一致

### 3. 动态知识库系统

#### 知识库分类
- **创作示例库**：按体裁、风格、主题分类
- **写作技巧库**：情节构建、人物塑造、冲突设计
- **背景设定库**：世界设定、文化背景、历史资料
- **模板库**：叙事结构、故事弧线、人物模型

#### 管理功能
- **在线编辑**：Web界面实时编辑知识内容
- **批量操作**：导入、导出、批量更新
- **版本控制**：跟踪知识变更历史
- **检索增强**：向量检索 + 关键词检索
- **动态注入**：为创作提供上下文增强

### 4. 短篇小说创作流程 (1-2万字)

#### 工作流程
1. **主题选择与设定**：用户选择主题或自定义设定
2. **知识库检索**：系统检索相关素材和示例
3. **角色配置与模型选择**：选择各角色AI模型
4. **提示词定制**：基于GUI调整提示词
5. **大纲生成**：分章节大纲生成
6. **章节创作**：多轮迭代完成创作
7. **质量控制**：多代理审查与优化
8. **成品输出**：格式化输出和评估

#### 章节划分策略
- 1-2万字按主题内容划分为2-5章
- 每章1000-4000字，保证内容连贯性
- 设置检查点，确保前后一致

## 技术实现要点

### 1. 数据存储
- 持久化存储创作过程和结果：JSON文件或数据库
- 版本化知识库：Git版本控制或专门知识库格式
- 会话状态：Redis或本地存储

### 2. 安全与权限
- 提示词和AI配置的安全存储
- API密钥管理
- 用户数据隔离

### 3. 性能优化
- AI模型API响应缓存
- 向量索引优化
- 异步处理创作任务
- 前端懒加载和状态管理

### 4. 可扩展性
- 插件化AI模型接入
- 可扩展的角色系统
- 模块化解耦设计

## 实现路标 (Milestones)

### Phase 1: 基础架构
- [ ] 重构目录结构
- [ ] 实现基础Web UI
- [ ] 建立AI代理抽象层

### Phase 2: 模型管理
- [ ] 实现多模型选择器
- [ ] 为各角色分配适合模型
- [ ] 实现模型配置管理界面

### Phase 3: 知识库系统
- [ ] 建立知识库基础架构
- [ ] 实现知识检索功能
- [ ] 添加动态知识管理界面

### Phase 4: 提示词系统
- [ ] 实现提示词模板系统
- [ ] 添加可视化编辑器
- [ ] 实现提示词测试功能

### Phase 5: 集成测试
- [ ] 完成端到端流程
- [ ] 优化1-2万字创作流程
- [ ] 性能调优和用户测试

## 预期效果

通过这个增强版设计，AgentPress将能够：
1. 生成高质量的1-2万字短篇小说
2. 支持多种题材（不限于山海经）
3. 通过图形界面灵活配置各角色
4. 利用知识库提高生成质量
5. 为不同角色选择最适合的AI模型
6. 提供友好的提示词管理界面